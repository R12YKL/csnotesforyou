<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Study Notes - CS Notes For You</title>
    <!-- Link to the shared stylesheet. When served by Vercel, this file
         resolves relative to /public/styles.css -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container header-row">
            <h1 class="logo">CS Notes For You</h1>
            <nav class="main-nav">
                <a href="index.html">Home</a>
                <a href="papers.html">Papers</a>
                <a href="solutions.html">Solutions</a>
                <a href="notes.html" class="active">Notes</a>
                <a href="revision.html">Revision</a>
                <a href="contribute.html">Contribute</a>
                <a href="about.html">About</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section class="notes-section">
            <h2>Notes</h2>
            <div id="notes-root"></div>
        </section>
    </main>

    <footer id="footer" class="site-footer container">
        <p>Built for CS students â€” view and share past papers, solutions and notes.</p>
    </footer>

    <script>
    // Modern, robust script to load and display notes grouped by topic
    async function loadNotes() {
        const root = document.getElementById('notes-root');
        root.innerHTML = '<div>Loading notes...</div>';
        try {
            // Fetch the notes data from the relative /data directory. On Vercel
            // this resolves to /public/data/notes.json because the public folder
            // is served as the root of static files.
            const res = await fetch('data/notes.json');
            if (!res.ok) throw new Error('Failed to load notes data.');
            const data = await res.json();
            root.innerHTML = '';
            if (!data.sections || !Array.isArray(data.sections)) {
                root.innerHTML = '<div>No notes found.</div>';
                return;
            }
            data.sections.forEach(section => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'notes-section';
                const h3 = document.createElement('h3');
                h3.textContent = section.title;
                sectionDiv.appendChild(h3);
                if (Array.isArray(section.notes)) {
                    const notesGrid = document.createElement('div');
                    notesGrid.className = 'notes-grid';
                    section.notes.forEach(note => {
                        // If note has nested sections, flatten them
                        if (note.sections && Array.isArray(note.sections)) {
                            note.sections.forEach(subSection => {
                                if (subSection.notes && Array.isArray(subSection.notes)) {
                                    subSection.notes.forEach(subNote => {
                                        notesGrid.appendChild(renderNoteCard(subNote));
                                    });
                                }
                            });
                        } else {
                            notesGrid.appendChild(renderNoteCard(note));
                        }
                    });
                    sectionDiv.appendChild(notesGrid);
                }
                root.appendChild(sectionDiv);
            });
        } catch (e) {
            root.innerHTML = '<div style="color:red">Error loading notes: ' + e.message + '</div>';
        }
    }

    function renderNoteCard(note) {
        const card = document.createElement('div');
        card.className = 'note-item';
        const title = document.createElement('h4');
        title.textContent = note.title || 'Untitled Note';
        card.appendChild(title);
        if (note.studyVersion) {
            const content = document.createElement('div');
            content.className = 'note-content';
            // Key Ideas
            if (note.studyVersion.keyIdeas && note.studyVersion.keyIdeas.length) {
                const keyIdeas = document.createElement('ul');
                keyIdeas.className = 'content-list';
                note.studyVersion.keyIdeas.forEach(idea => {
                    const li = document.createElement('li');
                    li.textContent = idea;
                    keyIdeas.appendChild(li);
                });
                content.appendChild(keyIdeas);
            }
            // Definitions
            if (note.studyVersion.definitions && note.studyVersion.definitions.length) {
                const defs = document.createElement('section');
                defs.innerHTML = '<strong>Definitions:</strong><ul class="content-list">' +
                    note.studyVersion.definitions.map(d => `<li>${d}</li>`).join('') + '</ul>';
                content.appendChild(defs);
            }
            // Steps
            if (note.studyVersion.steps && note.studyVersion.steps.length) {
                const steps = document.createElement('section');
                steps.innerHTML = '<strong>Steps:</strong><ul class="content-list">' +
                    note.studyVersion.steps.map(s => `<li>${s}</li>`).join('') + '</ul>';
                content.appendChild(steps);
            }
            // Mistakes
            if (note.studyVersion.mistakes && note.studyVersion.mistakes.length) {
                const mistakes = document.createElement('section');
                mistakes.innerHTML = '<strong>Common Mistakes:</strong><ul class="content-list">' +
                    note.studyVersion.mistakes.map(m => `<li>${m}</li>`).join('') + '</ul>';
                content.appendChild(mistakes);
            }
            // Mini Check
            if (note.studyVersion.miniCheck && note.studyVersion.miniCheck.length) {
                const mini = document.createElement('section');
                mini.innerHTML = '<strong>Mini Check:</strong><ul class="content-list">' +
                    note.studyVersion.miniCheck.map(q => `<li><em>${q.q}</em> <span style="color:#4f46e5">${q.a}</span></li>`).join('') + '</ul>';
                content.appendChild(mini);
            }
            // Memory Hook
            if (note.studyVersion.memoryHook) {
                const hook = document.createElement('div');
                hook.innerHTML = `<strong>Memory Hook:</strong> ${note.studyVersion.memoryHook}`;
                content.appendChild(hook);
            }
            card.appendChild(content);
        } else if (note.content) {
            const content = document.createElement('div');
            content.className = 'note-content';
            // Replace newline characters with <br> tags for HTML display
            content.innerHTML = note.content.replace(/\n/g, '<br>');
            card.appendChild(content);
        }
        return card;
    }

    window.addEventListener('DOMContentLoaded', loadNotes);
    </script>
</body>
</html>